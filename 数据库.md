[TOC]

# 一、mysql下载

下载网站：https://dev.mysql.com/downloads/mysql/

说明：下载5.7.20版本，根据需求下载

菜鸟网址：https://www.runoob.com/mysql/mysql-create-database.html



# 二、mysql安装

![image-20220114135601908](https://gitee.com/tang-zhanpeng/blog-img/raw/master/img/image-20220114135601908.png)

## 2.1配置环境变量

- 如果是`bash`,执行`open ~/.bash_profile`；如果是`zsh`,执行`open ~/.zshrc`
- 添加语句`PATH=$PATH:/usr/local/mysql/bin`,保存
- 立即生效，`source ~/.bash_profile` or `source ~/.zshrc`

# 三、mysql常用命令

## 3.1登录命令

```
mysql -uroot -p
```

## 3.2修改密码

```
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('你的新密码');
```

## 3.3备份数据库

```
mysqldump -u root -p book > /Users/sqmall/Desktop/book.sql
```

## 3.4恢复数据库

```mysql
Source /Users/sqmall/Desktop/book.sql;
```

## 3.5查看mysql启动帮助

```
mysqld --help --verbose | less
```

可以查看配置文件路径等，通过homebrew安装的mysql目录如下

```
Default options are read from the following files in the given order:
/etc/my.cnf /etc/mysql/my.cnf /opt/homebrew/etc/my.cnf ~/.my.cnf 
```

## 3.6查询慢sql

```
mysqldumpslow --help  // 查看配置详情参考
mysqldumpslow -a -s t -t 5 192-slow.log
rm 192-slow.log //删除慢查询日志
mysqladmin -uroot -p flush-logs slow //刷新慢查询日志
```

mysqldumpslow 命令的具体参数如下：

- -a: 不将数字抽象成N，字符串抽象成S 

- -s: 是表示按照何种方式排序：

  c: 访问次数

  l: 锁定时间

  r: 返回记录

  t: **查询时间**

  al:平均锁定时间

  ar:平均返回记录数

  at:平均查询时间 （默认方式）

  ac:平均查询次数

- -t: 即为返回前面多少条的数据；-g: 后边搭配一个正则匹配模式，大小写不敏感的；

- -g: 后边搭配一个正则匹配模式，大小写不敏感的；

```sql
set global slow_query_log='ON';#开启慢查询日志
SET GLOBAL slow_query_log=off;#关闭慢查询日志
show variables like '%low_query_log%';#查看是否开启日志以及日志位置
set global long_query_time = 1;#设置慢查询阈值-全局
set long_query_time=1;#设置慢查询阈值-当前
```

## 3.7重启mysql服务

Linux

```
systemctl restart mysqld
```

Mac - homebrew

```
brew services restart mysql #重启
brew services stop mysql #停止
brew services start mysql #启动
```

